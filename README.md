# StarRupture Mod Loader

** This is an extremely early project, use at your own risk **

A DLL-injection mod loader for **StarRupture** (Unreal Engine 5) dedicated servers. It works by acting as a proxy for the system `version.dll`, loading itself into the game process at startup and then discovering and initialising plugin DLLs from an `alienx_mods` subfolder.

---

## How It Works

1. `version.dll` (the proxy) is placed next to the game executable. Windows loads it first because it shadows the real system `version.dll`.
2. On `DLL_PROCESS_ATTACH` the proxy initialises itself, forwards all original `version.dll` exports to the real system library, and then begins loading mods.
3. It scans the `alienx_mods\` directory next to the executable and loads every `.dll` it finds.
4. Each plugin DLL is validated against the plugin interface version and initialised with access to the **Logger**, **Config**, **Scanner**, and **Hooks** interfaces.
5. On process exit all plugins are shut down cleanly and the proxy unloads.

---

## Project Structure

```
StarRupture-ModLoader/
├── Version_Mod_Loader/      # The version.dll proxy + core mod loader
├── KeepTicking_Plugin/      # Example plugin: keeps the server alive with no players
├── src/                     # Unreal Engine 5 SDK (generated by Dumper-7)
└── build/
    ├── Debug/
    │   ├── version.dll
    │   └── alienx_mods/
    │       └── KeepTicking.dll
    └── Release/
        ├── version.dll
        └── alienx_mods/
            └── KeepTicking.dll
```

---

## Building

### Requirements

- Visual Studio 2022 (v143 toolset)
- Windows 10 SDK
- C++20

### Steps

1. Open `StarRupture-ModLoader.sln` in Visual Studio 2022.
2. Select **Debug** or **Release** configuration (x64 only).
3. Build the solution (`Ctrl+Shift+B`).

After building, the `build\<Configuration>\` folder will contain:

| File | Description |
|---|---|
| `version.dll` | The mod loader proxy |
| `alienx_mods\KeepTicking.dll` | The KeepTicking example plugin |

---

## Installation

1. Copy `version.dll` to your server's executable directory (e.g. `StarRupture\Binaries\Win64\`).
2. Create an `alienx_mods\` folder in that same directory (the loader will create it automatically if it is missing).
3. Copy any plugin DLLs into `alienx_mods\`.
4. Start the server — the loader initialises automatically.

Log output is written to the same directory as the executable.

---

## Writing a Plugin

All plugins must export three C functions and fill in a `PluginInfo` struct.

### Required Exports

```cpp
extern "C" {
    __declspec(dllexport) PluginInfo* GetPluginInfo();
    __declspec(dllexport) bool        PluginInit(IPluginLogger*, IPluginConfig*, IPluginScanner*, IPluginHooks*);
    __declspec(dllexport) void        PluginShutdown();
}
```

### PluginInfo

```cpp
static PluginInfo s_info = {
    "MyPlugin",               // name
    "1.0.0",                  // version
    "YourName",               // author
    "What this plugin does",  // description
    PLUGIN_INTERFACE_VERSION  // must match loader's version
};
```

### Interfaces Available at Init

| Interface | Purpose |
|---|---|
| `IPluginLogger` | Structured logging (Trace / Debug / Info / Warn / Error) |
| `IPluginConfig` | Read/write per-plugin `.ini` files from `alienx_mods\config\` |
| `IPluginScanner` | IDA-style pattern scanning against the game executable |
| `IPluginHooks` | Install/remove inline hooks, patch memory, register for `WorldBeginPlay` events |

### Minimal Plugin Example

```cpp
#include "plugin_interface.h"

static PluginInfo s_info = { "MyPlugin", "1.0.0", "Me", "Does stuff", PLUGIN_INTERFACE_VERSION };
static IPluginLogger* g_log = nullptr;

extern "C" {

PluginInfo* GetPluginInfo() { return &s_info; }

bool PluginInit(IPluginLogger* logger, IPluginConfig*, IPluginScanner*, IPluginHooks*)
{
    g_log = logger;
    g_log->Info("MyPlugin", "Hello from MyPlugin!");
    return true;
}

void PluginShutdown()
{
    g_log->Info("MyPlugin", "Shutting down.");
}

}
```

### Pattern Scanning

```cpp
// IDA-style hex pattern, ?? is a wildcard byte
uintptr_t addr = scanner->FindPatternInMainModule("48 89 5C 24 ?? 57 48 83 EC 20");
if (addr) { /* use addr */ }
```

### Hooking

```cpp
typedef void (*OriginalFunc_t)(void*);
static OriginalFunc_t Original = nullptr;

void MyDetour(void* self)
{
    // pre-call logic
    Original(self);
    // post-call logic
}

// In PluginInit:
HookHandle h = hooks->InstallHook(targetAddress, (void*)MyDetour, (void**)&Original);
```

### WorldBeginPlay Event

```cpp
void OnWorldBeginPlay(SDK::UWorld* world)
{
    // Called when the main game world begins play
}

// In PluginInit:
hooks->RegisterWorldBeginPlayCallback(OnWorldBeginPlay);
```

---

## Included Plugin — KeepTicking

**KeepTicking** prevents a StarRupture dedicated server from sleeping or reducing its tick rate when no players are connected, ensuring the world simulation keeps running at full speed at all times.

---

## Interface Versioning

`PLUGIN_INTERFACE_VERSION` (defined in `plugin_interface.h`) is checked at load time. If a plugin's declared interface version does not match the loader's version, the plugin is rejected and a message is written to the log. Increment this constant whenever a breaking change is made to any of the four plugin interfaces.

---

## License

This project is provided as-is for personal and community use.
